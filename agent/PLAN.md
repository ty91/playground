# PLAN

## 목표
- REPL → pi-agent-core + pi-ai + pi-tui 기반 재구현

## 범위
- 모델/툴 호출, 이벤트 스트림, TUI 렌더, 설정/환경변수, 실행 스크립트

## 의사결정 입력
- 기본 provider/model: google-genai / gemini-3.0-flash
- tool 세트 범위: 없음
- TUI UI 구성 (입력/출력/상태 표시)

## Phase 0: 준비/정합성
- 입력: 현재 코드(`src/*`) + package.json
- 작업:
  - 현행 흐름 도식화: 입력 → 모델 호출 → 스트림 출력 → 종료
  - 현행 tool 표면적 확인 (없음 명시)
  - 현재 환경변수/모델명 정리
- 산출물: 현행 기능 매핑 표
- 완료 기준: 구현 전환에 필요한 기능 목록이 빠짐없이 정리됨

## Phase 1: 의존성/구조 전환 설계
- 입력: pi-* 패키지 API 개요, 현행 매핑 표
- 작업:
  - pi-ai provider 선택 기준 수립
  - 에이전트 이벤트→UI 업데이트 매핑 설계
  - tool 없음 전제, 에이전트 이벤트/출력만 설계
- 산출물: 전환 설계 문서(파일별 변경 포인트)
- 완료 기준: 어떤 파일을 어떻게 바꿀지 명확

## Phase 2: 의존성 교체
- 입력: Phase 1 설계
- 작업:
  - 패키지 의존성 교체( pnpm 사용 )
  - 불필요 의존성 제거(`ai`, `@ai-sdk/google`)
- 산출물: package.json/pnpm-lock 업데이트
- 완료 기준: 빌드 그래프에서 ai SDK 제거, pi-* 추가됨

## Phase 3: 설정/환경변수 전환
- 입력: provider/model 결정
- 작업:
  - `src/configuration.ts`를 pi-ai 기준으로 재정의
  - pi-ai 모델 목록에서 `gemini-3` 계열 정확한 id 확인
  - 기본 모델/키 이름 문서화 (GEMINI_API_KEY)
- 산출물: 설정 로딩 로직, 환경변수 명세
- 완료 기준: 단일 설정 진입점에서 provider/키/모델 확정

## Phase 4: 에이전트 코어 이행
- 입력: tool 목록, 이벤트 매핑 설계
- 작업:
  - Agent 생성/초기화 흐름 이식
  - tool 등록 및 실행 계약 반영
  - 이벤트 스트림을 내부 상태로 변환
- 산출물: agent 레이어 코드 전환
- 완료 기준: 대화 턴이 이벤트로 흘러감

## Phase 5: TUI 전환
- 입력: 이벤트 매핑 설계
- 작업:
  - pi-tui Component 설계(출력/입력/상태 영역)
  - 스트리밍 출력과 입력 편집 동시 처리
  - 종료 핫키/에러 표시 처리
- 산출물: TUI 레이어 코드 전환
- 완료 기준: UI가 깜빡임 없이 스트림 출력 가능

## Phase 6: 통합/검증
- 입력: 전환된 코드
- 작업:
  - 기본 대화 시나리오 검증
- tool 호출/응답 시나리오 검증 (해당 없음)
  - 오류/중단/종료 처리 검증
- 산출물: 검증 결과 메모
- 완료 기준: 필수 시나리오 모두 통과

## Phase 7: 문서/정리
- 입력: 변경사항
- 작업:
  - 실행 방법/환경변수/모델 선택 문서화
  - 변경사항 요약
- 산출물: 문서 갱신
- 완료 기준: 새 사용자도 실행 가능

## 검증 기준
- 기본 대화 성공
- tool 호출 이벤트 정상
- 스트림 출력 끊김/깨짐 없음
- 종료 핫키 동작

## 리스크
- pi-agent-core API 변경 가능성
- pi-tui 입력 처리 차이
- provider 키/모델 명 불일치

## 질문
- 없음
